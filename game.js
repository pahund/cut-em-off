!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);const n="N",s="E",a="S",i="W";var o=(e,t)=>l[e].change[t]||t,l={1:{allowed:[a,s],change:{[n]:s,[i]:a}},2:{allowed:[i,a],change:{[n]:i,[s]:a}},3:{allowed:[n,a],change:{}},4:{allowed:[i,n,s],change:{[a]:n}},5:{allowed:[n,s,a],change:{[i]:s}},6:{allowed:[i,s,a],change:{[n]:a}},9:{allowed:[n,s],change:{[a]:s,[i]:n}},10:{allowed:[i,n],change:{[s]:n,[a]:i}},11:{allowed:[i,s],change:{}},12:{allowed:[n,s,a,i],change:{}},13:{allowed:[n,a,i],change:{[s]:i}},14:{allowed:[n,a],change:{}},17:{allowed:[a],change:{[n]:a}},18:{allowed:[i],change:{[s]:i}},19:{allowed:[n],change:{[a]:n}},20:{allowed:[s],change:{[i]:s}}};const c=[];for(const[e,{allowed:t}]of Object.entries(l))t.length>2&&c.push(Number(e));var u=({map:e,player:t,virus:r,users:o,messageBox:l})=>kontra.gameLoop({update(){r.update(),t.update(),t.infect(r,l),((e,t)=>{switch(t){case n:e.sy-=5;break;case s:e.sx+=5;break;case a:e.sy+=5;break;case i:e.sx-=5}})(e,t.direction),o.update(),o.infect([r],l)},render(){e.render(),o.render(),t.render(),r.render()}}),d=e=>e*Math.PI/180,h=(e,t)=>{const r=Math.min(e,t),n=Math.max(e,t);return Math.floor(Math.random()*(n-r+1))+r},p=(e,{row:t,col:r,x:n,y:s})=>{const{tileWidth:a,tileHeight:i,sx:o,sy:l}=e;return{x:(void 0!==n?n:(r-1)*a)-o+400+a/2,y:(void 0!==s?s:(t-1)*i)-l+300+i/2}},m=(e,t)=>{const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)<e.collisionRadius+t.collisionRadius},y=[0,17,0,0,0,17,0,0,0,17,0,0,0,17,0,0,0,17,0,0,20,4,11,2,1,4,2,0,0,5,11,6,11,13,0,1,11,12,2,0,0,1,11,10,9,11,13,0,0,3,0,3,0,5,11,13,0,3,3,0,0,3,1,11,6,11,10,0,1,4,2,9,11,13,0,9,11,10,3,0,0,3,3,0,3,0,0,0,3,1,13,0,0,3,0,0,0,0,5,18,0,3,3,0,14,0,1,11,10,3,9,11,6,4,11,6,2,0,3,0,0,3,3,0,3,0,3,0,0,3,0,0,3,0,0,3,3,0,3,0,0,9,13,0,5,11,10,0,0,3,1,11,10,0,0,3,3,0,3,0,0,0,3,0,3,0,0,0,1,4,10,0,0,0,0,3,5,11,4,18,0,1,13,0,5,11,2,0,3,0,1,11,11,11,11,12,10,0,0,0,0,3,3,0,3,0,5,11,13,0,9,11,2,0,0,3,0,0,1,18,0,9,10,0,5,11,10,0,9,11,11,11,12,11,6,10,0,0,3,0,0,0,0,0,3,1,11,2,1,11,11,11,10,0,3,0,1,11,4,18,20,6,6,11,10,3,0,3,3,0,0,0,1,2,9,11,12,11,2,0,0,3,3,0,0,3,0,3,3,1,11,2,3,3,0,0,3,0,3,0,0,5,4,2,0,5,11,10,3,3,0,5,12,4,11,11,13,0,5,18,0,3,0,5,11,12,11,6,10,9,6,10,3,0,0,0,9,11,10,0,20,4,11,13,0,3,0,9,11,11,13,0,9,11,6,11,6,6,11,18,0,0,0,3,0,3,0,0,0,0,5,11,11,2,3,0,3,3,0,0,0,0,0,19,0,19,0,0,0,0,19,0,0,19,9,11,10,19,0,0];let f=null;var g=(e,t)=>{const r=kontra.sprite({x:400,y:300,collisionRadius:30,map:e,infected:!1,gameOver:!1,direction:"N",nextDirection:null,update(){({nextDirection:this.nextDirection,direction:this.direction}=x(this))},render(){b(this)},infect(e,r){m(e,this)&&(this.infected=!0,this.gameOver||(r.show("player infected<br>game over"),t.publish(0)))}});return t.subscribe(0,()=>r.gameOver=!0),r},b=e=>{const{context:t,x:r,y:o,direction:l,infected:c}=e;t.save(),t.translate(r,o),t.rotate((e=>{switch(e){case n:return d(0);case s:return d(90);case a:return d(180);case i:return d(270);default:return null}})(l)),t.lineWidth=3,t.strokeStyle=c?"#cd3926":"#75a042",t.fillStyle=c?"#7a2431":"#365b1d",t.beginPath(),t.moveTo(-15,25),t.lineTo(0,-25),t.lineTo(15,25),t.closePath(),t.fill(),t.stroke(),t.restore()},x=e=>{let{nextDirection:t,direction:r}=e;const{map:c,x:u,y:d,gameOver:h}=e;if(h||(t=(kontra.keys.pressed("right")?s:kontra.keys.pressed("left")?i:kontra.keys.pressed("up")?n:kontra.keys.pressed("down")?a:null)||t),!(({x:e,y:t})=>(e-50)%100==0&&(t-50)%100==0)({x:c.sx,y:c.sy}))return{direction:r,nextDirection:t};const p=c.tileAtLayer("main",{x:u,y:d});return t&&((e,t)=>l[e].allowed.includes(t))(p,t)?(r=t,t=null):r=o(p,r),{direction:r,nextDirection:t}};var v=({map:e,row:t,col:r})=>{const{x:n,y:s}=p(e,{row:t,col:r});return kontra.sprite({x:n,y:s,collisionRadius:30,infected:!1,map:e,mapX:100*(r-1),mapY:100*(t-1),status:0,update(){({x:this.x,y:this.y}=p(this.map,{x:this.mapX,y:this.mapY}))},render(){k(this)},infect(){this.status=2}})};const w={0:{sx:600,sy:0},1:{sx:600,sy:0},2:{sx:700,sy:100}};var k=e=>{const{context:t,x:r,y:n,status:s}=e,{sx:a,sy:i}=w[s];t.save(),t.translate(r,n),t.drawImage(kontra.assets.images.tilesheet,a,i,100,100,-50,-50,100,100),t.restore()},T=e=>{const{x:t,y:r}=p(e,{row:4,col:5});return kontra.sprite({x:t,y:r,collisionRadius:30,map:e,mapX:400,mapY:300,direction:"W",update(){({x:this.x,y:this.y,mapX:this.mapX,mapY:this.mapY,direction:this.direction}=O(this))},render(){Y(this)}})};const X=Array(20).fill().map(()=>Array(20).fill(0));var O=e=>{let{direction:t,x:r,y:u}=e;const{map:d}=e,{mapX:m,mapY:y}=(({mapX:e,mapY:t,direction:r})=>{switch(r){case n:return{mapX:e,mapY:t-2.5};case s:return{mapX:e+2.5,mapY:t};case a:return{mapX:e,mapY:t+2.5};case i:return{mapX:e-2.5,mapY:t};default:return{mapX:e,mapY:t}}})(e);if((({mapX:e,mapY:t})=>e%100==0&&t%100==0)({mapX:m,mapY:y})){const e=d.tileAtLayer("main",{x:r,y:u}),p=m/100+1,f=y/100+1;if(X[f-1][p-1]=X[f-1][p-1]+1,(e=>c.includes(e))(e)){const{allowed:r}=l[e],o=(({viable:e,visits:t,row:r,col:o})=>{let l=Number.MAX_SAFE_INTEGER;return e.map(e=>{let c;switch(e){case n:c=t[r-2][o-1];break;case s:c=t[r-1][o];break;case a:c=t[r][o-1];break;case i:c=t[r-1][o-2]}return l=c<l?c:l,{dir:e,vis:c}}).filter(({vis:e})=>e===l).map(({dir:e})=>e)})({viable:r.filter(e=>e!==(e=>{switch(e){case n:return a;case s:return i;case a:return n;case i:return i;default:return null}})(t)),visits:X,row:f,col:p});t=o[h(0,o.length-1)]}else t=o(e,t)}return({x:r,y:u}=p(d,{x:m,y:y})),{direction:t,mapY:y,mapX:m,x:r,y:u}},Y=e=>{const{context:t,x:r,y:n}=e;t.save(),t.translate(r,n),t.lineWidth=3,t.strokeStyle="#cd3926",t.fillStyle="#7a2431",t.beginPath(),t.moveTo(h(-5,5),h(-5,-25)),t.lineTo(h(5,50),h(-5,-50)),t.lineTo(h(5,25),h(-5,5)),t.lineTo(h(5,50),h(5,50)),t.lineTo(h(-5,5),h(5,25)),t.lineTo(h(-5,-50),h(5,50)),t.lineTo(h(-5,-25),h(-5,5)),t.lineTo(h(-5,-50),h(-5,-50)),t.closePath(),t.fill(),t.stroke(),t.restore()};(async()=>{const e=new class{constructor(){this.subscribers=[]}subscribe(e,t){this.subscribers.push({message:e,callback:t})}publish(e,t){this.subscribers.forEach(({message:r,callback:n})=>r===e&&n(t))}};(()=>{const e=document.createElement("canvas");e.width=800,e.height=600,e.style.cssText="\n        border: 4px solid #52638a;\n    ",document.getElementById("wrapper").appendChild(e)})(),kontra.init(),await(async()=>await kontra.assets.load("tilesheet.png"))();const t=(()=>{const{sx:e,sy:t}=(({col:e,row:t})=>({sx:100*(e-1)+50,sy:100*(t-1)+50}))({col:5,row:6}),r=kontra.tileEngine({tileWidth:100,tileHeight:100,width:28,height:26,sx:e,sy:t}),n=((e,t,r,n,s)=>{const a=[];let i=0;for(let o=0;o<r+2*s;o++)for(let l=0;l<t+2*n;l++)o<s||o>=s+r||l<n||l>=n+t?a.push(0):a.push(e[i++]);return a})(y,20,20,4,3);return r.addTilesets({image:kontra.assets.images.tilesheet}),r.addLayers([{name:"main",data:n}]),r})(),r=g(t,e),n=T(t),s=new class{constructor(e,t){this.map=e,this.pubsub=t,this.users=[],this.gameOver=!1;for(let t=1;t<=26;t++)for(let r=1;r<=28;r++){const n=e.tileAtLayer("main",{row:t,col:r});n>=17&&n<=20&&this.users.push(v({map:e,row:t-3+1,col:r-4+1}))}this.pubsub.subscribe(0,()=>this.gameOver=!0)}update(){this.users.forEach(e=>e.update())}render(){this.users.forEach(e=>e.render())}infect(e,t){const{users:r,pubsub:n,gameOver:s}=this,a=((e,t)=>{const r=[];for(let n=0;n<e.length;n++){const s=e[n];for(let e=0;e<t.length;e++){const n=t[e];m(s,n)&&r.push([s,n])}}return r})(r,e).filter(([e])=>2!==e.status);if(0!==a.length&&(a.forEach(([e])=>e.infect()),!s))return(e=>e.every(e=>2===e.state))(r)?(t.show("all users infected<br>game over"),void n.publish(0)):void t.flash("user infected!")}}(t,e),a={},i=(()=>{const e=document.createElement("div");return e.style.cssText="\n        background-color: rgba(0,0,0,0);\n        font-size: 3em;\n        font-weight: bold;\n        align-items: center;\n        justify-content: center;\n        display: flex;\n        color: rgba(255,255,255,0);\n        position: absolute;\n        top: 0;\n        left:0;\n        width: 100vw;\n        height: 100vh;\n        text-align: center;\n        pointer-events: none;\n        transition: background-color 3s ease-out, color 3s ease-out;\n        text-transform: uppercase;\n        font-family: monospace;\n    ",document.getElementById("wrapper").appendChild(e),{show(t){clearTimeout(f),e.style.transition="3s",e.innerHTML=`<div>${t}</div>`,e.style.backgroundColor="rgba(0,0,0,0.5)",e.style.color="rgba(255,255,255,1)"},flash(t){clearTimeout(f),e.style.transition="0.5s",e.innerHTML=`<div>${t}</div>`,e.style.color="rgba(255,255,255,1)",f=setTimeout(()=>{e.style.color="rgba(255,255,255,0)"},500)}}})();u({map:t,player:r,virus:n,users:s,devbox:a,messageBox:i}).start()})()}]);
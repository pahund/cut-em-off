!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const r="N",a="E",o="S",i="W";var l=(e,t)=>s[e].change[t]||t,s={1:{allowed:[o,a],change:{[r]:a,[i]:o}},2:{allowed:[i,o],change:{[r]:i,[a]:o}},3:{allowed:[r,o],change:{}},4:{allowed:[i,r,a],change:{[o]:r}},5:{allowed:[r,a,o],change:{[i]:a}},6:{allowed:[i,a,o],change:{[r]:o}},9:{allowed:[r,a],change:{[o]:a,[i]:r}},10:{allowed:[i,r],change:{[a]:r,[o]:i}},11:{allowed:[i,a],change:{}},12:{allowed:[r,a,o,i],change:{}},13:{allowed:[r,o,i],change:{[a]:i}},14:{allowed:[r,a,o,i],change:{}},17:{allowed:[o],change:{[r]:o}},18:{allowed:[i],change:{[a]:i}},19:{allowed:[r],change:{[o]:r}},20:{allowed:[a],change:{[i]:a}}};var c=({map:e,player:t,virus:n,devbox:l})=>kontra.gameLoop({update(){t.update(),n.update(),((e,t)=>{switch(t){case r:e.sy-=5;break;case a:e.sx+=5;break;case o:e.sy+=5;break;case i:e.sx-=5}})(e,t.direction)},render(){e.render(),t.render(),n.render();const r=e.tileAtLayer("main",{x:t.x,y:t.y}),a=e.tileAtLayer("main",{x:n.x,y:n.y}),{mapX:o,mapY:i}=n,{sx:s,sy:c}=e;l.innerHTML=`\n                tile player ${r};\n                virus ${a};\n                mapXY ${o}/${i}; sx/sy ${s}/${c}`}}),d=e=>e*Math.PI/180,u=(e,t)=>{const n=Math.min(e,t),r=Math.max(e,t);return Math.floor(Math.random()*(r-n+1))+n},y=(e,{row:t,col:n,x:r,y:a})=>{const{tileWidth:o,tileHeight:i,sx:l,sy:s}=e;return{x:(r||(n-1)*o)-l+400+o/2,y:(a||(t-1)*i)-s+300+i/2}},h=[0,17,0,0,0,17,0,0,0,17,0,0,0,17,0,0,0,17,0,0,20,4,11,2,1,4,2,0,0,5,11,6,11,13,0,1,11,12,2,0,0,1,11,10,9,11,13,0,0,3,0,3,0,5,11,13,0,3,3,0,0,3,1,11,6,11,10,0,1,4,2,9,11,13,0,9,11,10,3,0,0,3,3,0,3,0,0,0,3,1,13,0,0,3,0,0,0,0,5,18,0,3,3,0,14,0,1,11,10,3,9,11,6,4,11,6,2,0,3,0,0,3,3,0,3,0,3,0,0,3,0,0,3,0,0,3,3,0,3,0,0,9,13,0,5,11,10,0,0,3,1,11,10,0,0,3,3,0,3,0,0,0,3,0,3,0,0,0,1,4,10,0,0,0,0,3,5,11,4,18,0,1,13,0,5,11,2,0,3,0,1,11,11,11,11,12,10,0,0,0,0,3,3,0,3,0,5,11,13,0,9,11,2,0,0,3,0,0,1,18,0,9,10,0,5,11,10,0,9,11,11,11,12,11,6,10,0,0,3,0,0,0,0,0,3,1,11,2,1,11,11,11,10,0,3,0,1,11,4,18,20,6,6,11,10,3,0,3,3,0,0,0,1,2,9,11,12,11,2,0,0,3,3,0,0,3,0,3,3,1,11,2,3,3,0,0,3,0,3,0,0,5,4,2,0,5,11,10,3,3,0,5,12,4,11,11,13,0,5,18,0,3,0,5,11,12,11,6,10,9,6,10,3,0,0,0,9,11,10,0,20,4,11,13,0,3,0,9,11,11,13,0,9,11,6,11,6,6,11,18,0,0,0,3,0,3,0,0,0,0,5,11,11,2,3,0,3,3,0,0,0,0,0,19,0,19,0,0,0,0,19,0,0,19,9,11,10,19,0,0],p=e=>kontra.sprite({x:400,y:300,map:e,direction:"N",nextDirection:null,update(){({nextDirection:this.nextDirection,direction:this.direction}=m(this))},render(){x(this)}}),x=e=>{const{context:t,x:n,y:l,direction:s}=e;t.save(),t.translate(n,l),t.rotate((e=>{switch(e){case r:return d(0);case a:return d(90);case o:return d(180);case i:return d(270);default:return null}})(s)),t.lineWidth=3,t.strokeStyle="#75a042",t.fillStyle="#365b1d",t.beginPath(),t.moveTo(-15,25),t.lineTo(0,-25),t.lineTo(15,25),t.closePath(),t.fill(),t.stroke(),t.restore()},m=e=>{let{nextDirection:t,direction:n}=e;const{map:c,x:d,y:u}=e;if(t=(kontra.keys.pressed("right")?a:kontra.keys.pressed("left")?i:kontra.keys.pressed("up")?r:kontra.keys.pressed("down")?o:null)||t,!(({x:e,y:t})=>(e-50)%100==0&&(t-50)%100==0)({x:c.sx,y:c.sy}))return{direction:n,nextDirection:t};const y=c.tileAtLayer("main",{x:d,y:u});return t&&((e,t)=>s[e].allowed.includes(t))(y,t)?(n=t,t=null):n=l(y,n),{direction:n,nextDirection:t}},f=e=>{const{x:t,y:n}=y(e,{row:4,col:5});return kontra.sprite({x:t,y:n,map:e,mapX:400,mapY:300,direction:"W",update(){({x:this.x,y:this.y,mapX:this.mapX,mapY:this.mapY,direction:this.direction}=g(this))},render(){w(this)}})},g=e=>{let{direction:t,mapY:n,mapX:s,x:c,y:d}=e;const{map:u}=e;switch(t){case r:n-=2.5;break;case a:s+=2.5;break;case o:n+=2.5;break;case i:s-=2.5}if(s%100==0&&n%100==0){const e=u.tileAtLayer("main",{x:c,y:d});t=l(e,t)}return({x:c,y:d}=y(u,{x:s,y:n})),{direction:t,mapY:n,mapX:s,x:c,y:d}},w=e=>{const{context:t,x:n,y:r}=e;t.save(),t.translate(n,r),t.lineWidth=3,t.strokeStyle="#cd3926",t.fillStyle="#7a2431",t.beginPath(),t.moveTo(u(-5,5),u(-5,-25)),t.lineTo(u(5,50),u(-5,-50)),t.lineTo(u(5,25),u(-5,5)),t.lineTo(u(5,50),u(5,50)),t.lineTo(u(-5,5),u(5,25)),t.lineTo(u(-5,-50),u(5,50)),t.lineTo(u(-5,-25),u(-5,5)),t.lineTo(u(-5,-50),u(-5,-50)),t.closePath(),t.fill(),t.stroke(),t.restore()};(async()=>{(()=>{const e=document.createElement("canvas");e.width=800,e.height=600,e.style.cssText="\n        border: 4px solid #52638a;\n    ",document.getElementById("wrapper").appendChild(e)})(),kontra.init(),await(async()=>await kontra.assets.load("tilesheet.png"))();const e=(()=>{const{sx:e,sy:t}=(({col:e,row:t})=>({sx:100*(e-1)+50,sy:100*(t-1)+50}))({col:5,row:6}),n=kontra.tileEngine({tileWidth:100,tileHeight:100,width:28,height:26,sx:e,sy:t}),r=((e,t,n,r,a)=>{const o=[];let i=0;for(let l=0;l<n+2*a;l++)for(let s=0;s<t+2*r;s++)l<a||l>=a+n||s<r||s>=r+t?o.push(0):o.push(e[i++]);return o})(h,20,20,4,3);return n.addTilesets({image:kontra.assets.images.tilesheet}),n.addLayers([{name:"main",data:r}]),n})(),t=p(e),n=f(e);c({map:e,player:t,virus:n,devbox:{}}).start()})()}]);